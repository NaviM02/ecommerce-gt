<div class="detail-header-container">
  <app-detail-page-header
    [backRoute]="['/moderator', 'products']"
    [description]="'Detalle del producto'"
    [itemName]="product? product.name : ''"
  >
  </app-detail-page-header>
</div>
<div class="container py-4">
  <div class="row g-4">
    <div class="col-md-5 text-center" style="min-width: 400px; max-width: 400px; text-align:center;">
      @if(imagePreviewUrl) {
        <img [src]="imagePreviewUrl" class="img-fluid rounded border" alt="Imagen del producto" />
      }
    </div>

    <div class="col-md-7">
      <h2 class="fw-semibold">{{ product.name }}</h2>
      <p class="text-muted mb-1">{{ product.description }}</p>

      <div class="d-flex align-items-center mb-2">
        @if(product.averageRating && product.averageRating > 0) {
          @for(_ of getStars(Math.round(product.averageRating)); track _) {
            <i class="fa fa-star text-warning me-1"></i>
          }
          @for(_ of getEmptyStars(Math.round(product.averageRating)); track _) {
            <i class="fa-regular fa-star text-warning me-1"></i>
          }
          <span class="ms-2 fw-semibold">{{ product.averageRating }}/5</span>
        } @else {
          <span class="text-muted">Sin calificaciones aún</span>
        }
      </div>

      <h4 class="text-success fw-bold mt-2">{{ product.price }} GTQ</h4>
      <p class="mb-1"><strong>Condición:</strong> {{ product.condition === 1 ? 'Nuevo' : 'Usado' }}</p>
      <p class="mb-1"><strong>Stock:</strong> {{ product.stock }}</p>
      <p class="mb-1"><strong>Vendedor:</strong> {{ product.sellerName }}</p>

      <div class="mt-3">
        <strong>Categorías:</strong>
        @if(product.categories.length) {
          @for(cat of product.categories; track cat.categoryId) {
            <span class="badge bg-primary-subtle text-primary border mx-1">{{ cat.name }}</span>
          }
        } @else {
          <span class="text-muted">No hay categorías asignadas</span>
        }
      </div>
      <div class="d-flex flex-row gap-2 text-end">
        <button class="btn btn-outline-success mt-5" (click)="accept()">Aceptar</button>
        <button class="btn btn-outline-warning mt-5" (click)="reject()">Rechazar</button>
        <button class="btn btn-outline-danger mt-5" (click)="openSanctionModal()">Sancionar</button>
      </div>
    </div>
  </div>

  <hr class="my-4" />

  <div class="ratings mt-4">
    <h5 class="fw-semibold mb-3">Opiniones de compradores</h5>

    @if(product && product.ratings && product.ratings.length) {
      @for(r of product.ratings; track r.ratingId) {
        <div class="border rounded p-3 mb-3 bg-light">
          <div class="d-flex align-items-center mb-2">
            @for(_ of getStars(r.stars) ; track _) {
              <i class="fa fa-star text-warning me-1"></i>
            }
            @for(_ of getEmptyStars(r.stars) ; track _) {
              <i class="fa-regular fa-star text-warning me-1"></i>
            }
            <span class="ms-2 fw-bold">{{ r.username }}</span>
          </div>
          <p class="mb-0">{{ r.comment }}</p>
          <small class="text-muted">{{ r.createdAt | date:'mediumDate' }}</small>
        </div>
      }
    } @else {
      <p class="text-muted">Aún no hay comentarios para este producto.</p>
    }
  </div>
</div>
