<div class="cart p-3 border rounded shadow-sm bg-light">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="mb-0">Mi carrito</h5>
    <div class="d-flex flex-row gap-2">
      <button class="btn btn-sm btn-outline-secondary me-2" (click)="goToProducts()">Agregar producto</button>
      @if(cartItems.length) {
        <button class="btn btn-sm btn-outline-danger" (click)="clearCart()">Vaciar carrito</button>
      }
    </div>
  </div>

  @if(cartItems.length) {
    <div class="list-group mb-3">
      @for(item of cartItems; track item.product.productId) {
        <div class="list-group-item d-flex justify-content-between align-items-center flex-wrap">

          <div class="me-3">
            <img
              [src]="item.product.imageUrl ? environment.imagesUrl + item.product.imageUrl : '/assets/placeholder.png'"
              alt="{{ item.product.name }}"
              width="50"
              class="rounded"
            />
          </div>
          <div class="flex-grow-1">
            <strong>{{ item.product.name }}</strong>
            <small class="d-block text-muted">{{ item.product.price | number:'1.2-2' }} GTQ c/u</small>
            <div class="mt-1">
              <label class="me-1">Cantidad:</label>
              <input
                type="number"
                class="form-control d-inline-block"
                style="width: 80px;"
                [value]="item.quantity"
                min="1"
                [max]="item.product.stock"
                (change)="updateQuantity(item.product.productId, $event)"
              />
            </div>
          </div>

          <div class="d-flex flex-column gap-2 text-end">
            <div class="fw-semibold mb-1">
              {{ (item.product.price * item.quantity) | number:'1.2-2' }} GTQ
            </div>
            <button class="btn btn-sm btn-outline-primary" (click)="goToProduct(item.product.productId)">
              Ver producto
            </button>
            <button class="btn btn-sm btn-outline-danger" (click)="remove(item)">Eliminar</button>
          </div>
        </div>
      }
    </div>

    <hr />

    <div class="d-flex justify-content-between fw-bold mb-3">
      <span>Total:</span>
      <span>{{ getTotal() | number:'1.2-2' }} GTQ</span>
    </div>

    <div class="text-end">
      <button class="btn btn-primary" (click)="openPaymentModal()">Pagar carrito</button>
    </div>
  } @else {
    <p class="text-muted text-center mt-4">Tu carrito está vacío.</p>
  }
</div>
