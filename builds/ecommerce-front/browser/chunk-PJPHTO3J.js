import{a as ae}from"./chunk-V5LHGOGP.js";import"./chunk-BYXBJQAS.js";import{a as ne}from"./chunk-WEV7XX4Q.js";import{a as re,b as oe}from"./chunk-GXTZG3NX.js";import{a as ee,b as ie}from"./chunk-KCVL4ZD6.js";import{a as te}from"./chunk-CTBSQTUV.js";import{a as Z}from"./chunk-GYVK5SZF.js";import{d as $}from"./chunk-QNPVVT5S.js";import"./chunk-FDP5RWEF.js";import{a as Y}from"./chunk-IN5T55Q3.js";import{c as z,e as J,f as K,g as Q,m as X}from"./chunk-XALT67XN.js";import{a as x}from"./chunk-5UWBJBBU.js";import{d as O,k as q,m as H,o as G,t as M}from"./chunk-HGKDJBZM.js";import{Bb as y,Cb as s,Db as L,Ea as N,F as P,Ga as d,Gb as v,Hb as h,Ib as C,Kb as E,La as f,Lb as S,Pa as T,T as _,Ua as R,X as V,_a as l,aa as W,db as A,gb as k,hb as D,ia as m,ib as n,ja as u,jb as r,kb as g,l as I,ob as j,sb as F,tb as B,x as U}from"./chunk-DN3HB7UR.js";import"./chunk-PYEHUVGI.js";var b=class a{constructor(e){this.http=e}baseUrl=`${M.baseUrl}/categories`;findById(e){return this.http.get(`${this.baseUrl}/${e}`)}save(e){return e.categoryId?this.http.put(`${this.baseUrl}/${e.categoryId}`,e):this.http.post(this.baseUrl,e)}findAll(){return this.http.get(this.baseUrl)}delete(e){return this.http.delete(`${this.baseUrl}/${e}`)}static \u0275fac=function(o){return new(o||a)(W(q))};static \u0275prov=V({token:a,factory:a.\u0275fac,providedIn:"root"})};var pe=()=>["/user/my-products"],w=a=>({"is-invalid":a}),me=()=>["/user","my-products"],ue=(a,e)=>e.categoryId;function ge(a,e){if(a&1&&(n(0,"ng-option",14),s(1),r()),a&2){let o=e.$implicit;l("value",o),d(),L(o.name)}}function fe(a,e){if(a&1&&(n(0,"div",24),g(1,"img",27),r()),a&2){let o=B();d(),l("src",o.imagePreviewUrl,N)}}var de=class a{constructor(e,o,t,c,p,i){this.productService=e;this.categoryService=o;this.authService=t;this.toastService=c;this.router=p;this.route=i}ProductCondition=ae;id;product=new $;categories=[];selectedCategories=[];imageFile;imagePreviewUrl;ngOnInit(){this.route.paramMap.pipe(_(e=>this.id=Number(e.get("id"))),P(()=>this.categoryService.findAll()),_(e=>this.categories=e),P(()=>U(()=>!!this.id,this.productService.findById(this.id).pipe(_(e=>{this.product=e,this.selectedCategories=e.categories||[],e.imageUrl&&(this.imagePreviewUrl=M.imagesUrl+e.imageUrl)})),I(null)))).subscribe({error:e=>{if(e.status===404){this.toastService.error("El producto no existe."),this.router.navigate(["user","products"]);return}this.toastService.error("Ocurri\xF3 un error en el servidor.")}})}onSave(){if(!this.isValid)return this.toastService.warning("Campos requeridos faltantes");let e=this.authService.getUserId();if(!e)return;this.product.seller={userId:e},this.product.categories=this.selectedCategories,this.product.status=1;let o=new FormData;o.append("product",new Blob([JSON.stringify(this.product)],{type:"application/json"})),this.imageFile&&o.append("image",this.imageFile),this.productService.save(this.product,this.imageFile).subscribe({next:t=>{this.toastService.success("Producto guardado con \xE9xito"),this.router.navigate(["user","my-products"])},error:()=>this.toastService.error("Error al guardar el producto")})}get isValid(){return!!this.product.name?.trim()&&!!this.selectedCategories?.length}onImageSelected(e){let o=e.target.files?.[0];o&&(this.imageFile=o,this.imagePreviewUrl=URL.createObjectURL(o))}compareCategories(e,o){return!!e&&!!o&&e.categoryId===o.categoryId}static \u0275fac=function(o){return new(o||a)(f(ne),f(b),f(Y),f(x),f(G),f(H))};static \u0275cmp=T({type:a,selectors:[["app-my-product-form"]],decls:55,vars:30,consts:[["productName","ngModel"],["productCategories","ngModel"],["description","ngModel"],["condition","ngModel"],[1,"main-container"],[1,"body-container"],[1,"form-page-header-container"],[3,"title","description","backRoute"],[1,"body","bg-white","h-100"],[1,"row"],[1,"col-12","col-lg-6"],[1,"form-label","required-field"],["type","text","placeholder","Nombre del producto",1,"form-control",3,"ngModelChange","ngModel","ngClass"],["placeholder","Selecciona categor\xEDas",3,"ngModelChange","ngModel","multiple","compareWith","ngClass"],[3,"value"],[1,"col-12"],["for","description",1,"form-label","required-field"],["id","description","rows","3","placeholder","Describe el producto",1,"form-control",3,"ngModelChange","ngModel","ngClass"],[1,"col-12","col-lg-4"],["type","number","placeholder","0.00",1,"form-control",3,"ngModelChange","ngModel"],["type","number","placeholder","0",1,"form-control",3,"ngModelChange","ngModel"],["for","condition",1,"form-label","required-field"],["bindLabel","condition","placeholder","Condicion del producto",3,"ngModelChange","ngModel","ngClass"],["type","file",1,"form-control",3,"change"],[1,"mt-2"],[1,"form-actions-container"],[3,"saveAction","cancelRoute","saveText"],["alt","imagen :C",1,"img-thumbnail",2,"max-width","150px",3,"src"]],template:function(o,t){if(o&1){let c=j();n(0,"div",4)(1,"div",5)(2,"div",6),g(3,"app-form-page-header",7),r(),n(4,"div",8),g(5,"app-required-indicator"),n(6,"div",9)(7,"div",10)(8,"label",11),s(9,"Nombre"),r(),n(10,"input",12,0),C("ngModelChange",function(i){return m(c),h(t.product.name,i)||(t.product.name=i),u(i)}),r(),g(12,"app-input-invalid-feedback"),r(),n(13,"div",10)(14,"label",11),s(15,"Categor\xEDas"),r(),n(16,"ng-select",13,1),C("ngModelChange",function(i){return m(c),h(t.selectedCategories,i)||(t.selectedCategories=i),u(i)}),k(18,ge,2,2,"ng-option",14,ue),r(),g(20,"app-input-invalid-feedback"),r()(),n(21,"div",9)(22,"div",15)(23,"label",16),s(24,"Descripci\xF3n"),r(),n(25,"textarea",17,2),C("ngModelChange",function(i){return m(c),h(t.product.description,i)||(t.product.description=i),u(i)}),r(),g(27,"app-input-invalid-feedback"),r()(),n(28,"div",9)(29,"div",18)(30,"label",11),s(31,"Precio"),r(),n(32,"input",19),C("ngModelChange",function(i){return m(c),h(t.product.price,i)||(t.product.price=i),u(i)}),r()(),n(33,"div",18)(34,"label",11),s(35,"Stock"),r(),n(36,"input",20),C("ngModelChange",function(i){return m(c),h(t.product.stock,i)||(t.product.stock=i),u(i)}),r()(),n(37,"div",18)(38,"label",21),s(39,"Condici\xF3n"),r(),n(40,"ng-select",22,3),C("ngModelChange",function(i){return m(c),h(t.product.condition,i)||(t.product.condition=i),u(i)}),n(42,"ng-option",14),s(43,"Nuevo"),r(),n(44,"ng-option",14),s(45,"Usado"),r()(),g(46,"app-input-invalid-feedback"),r()(),n(47,"div",9)(48,"div",10)(49,"label",11),s(50,"Imagen"),r(),n(51,"input",23),F("change",function(i){return m(c),u(t.onImageSelected(i))}),r(),R(52,fe,2,1,"div",24),r()(),n(53,"div",25)(54,"app-form-actions",26),F("saveAction",function(){return m(c),u(t.onSave())}),r()()()()()}if(o&2){let c=y(11),p=y(17),i=y(26),ce=y(41);d(3),l("title",t.id?"Editar Producto":"Nuevo Producto")("description",t.id?"Modifica la informaci\xF3n del producto":"Crea un nuevo producto")("backRoute",E(20,pe)),d(7),v("ngModel",t.product.name),l("ngClass",S(21,w,c.touched&&!t.product.name)),d(6),v("ngModel",t.selectedCategories),l("multiple",!0)("compareWith",t.compareCategories)("ngClass",S(23,w,p.touched&&!t.selectedCategories)),d(2),D(t.categories),d(7),v("ngModel",t.product.description),l("ngClass",S(25,w,i.touched&&!(t.product.description&&t.product.description.trim()))),d(7),v("ngModel",t.product.price),d(4),v("ngModel",t.product.stock),d(4),v("ngModel",t.product.condition),l("ngClass",S(27,w,ce.touched&&!t.product.condition)),d(2),l("value",t.ProductCondition.NEW),d(2),l("value",t.ProductCondition.USED),d(8),A(t.imagePreviewUrl?52:-1),d(2),l("cancelRoute",E(29,me))("saveText",t.id?"Guardar":"Crear")}},dependencies:[ee,te,X,z,Q,J,K,oe,ie,Z,re,O],encapsulation:2})};export{de as MyProductFormComponent};
