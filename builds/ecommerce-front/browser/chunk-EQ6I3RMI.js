import{b as ne}from"./chunk-HP5ROPUU.js";import{a as k}from"./chunk-MZTENXYX.js";import{a as re}from"./chunk-PO4PTNSW.js";import{e as $,f as ee}from"./chunk-QNPVVT5S.js";import{a as te,b as ie}from"./chunk-BFNUI43J.js";import{i as J,j as K}from"./chunk-NCCT54UK.js";import{a as Z}from"./chunk-IN5T55Q3.js";import{b as B,c as Q,e as U,f as q,h as G,i as R,j as z,m as H}from"./chunk-XALT67XN.js";import{a as P}from"./chunk-5UWBJBBU.js";import{h as W,o as F,t as Y}from"./chunk-HGKDJBZM.js";import{Cb as c,Db as A,Ea as L,Eb as T,Fb as X,Ga as l,Gb as b,Hb as S,Ib as h,La as m,Pa as I,Pb as E,Rb as N,Ua as f,_a as v,db as g,gb as M,hb as w,ia as u,ib as n,ja as C,jb as r,kb as x,ob as _,sb as p,tb as s,wb as O}from"./chunk-DN3HB7UR.js";import{c as D}from"./chunk-PYEHUVGI.js";var se=(d,a)=>a.creditCardId;function pe(d,a){if(d&1&&(n(0,"option",13),c(1),r()),d&2){let e=a.$implicit;v("ngValue",e.creditCardId),l(),X(" **** **** **** ",e.cardNumber.slice(-4)," (",e.cardholderName,") ")}}function ue(d,a){if(d&1){let e=_();n(0,"div",4)(1,"label"),c(2,"Seleccionar tarjeta guardada:"),r(),n(3,"select",12),h("ngModelChange",function(i){u(e);let o=s();return S(o.selectedCardId,i)||(o.selectedCardId=i),C(i)}),n(4,"option",13),c(5,"-- Selecciona una tarjeta --"),r(),M(6,pe,2,3,"option",13,se),r()()}if(d&2){let e=s();l(3),b("ngModel",e.selectedCardId),l(),v("ngValue",void 0),l(2),w(e.cards)}}function Ce(d,a){if(d&1){let e=_();n(0,"div",8)(1,"input",14),h("ngModelChange",function(i){u(e);let o=s();return S(o.saveCard,i)||(o.saveCard=i),C(i)}),r(),n(2,"label",15),c(3," Guardar tarjeta para futuras compras "),r()()}if(d&2){let e=s();l(),b("ngModel",e.saveCard)}}var V=class d{constructor(a,e,t,i,o,j){this.activeModal=a;this.toastService=e;this.creditCardService=t;this.orderService=i;this.cartService=o;this.authService=j}cards=[];selectedCardId;cardNumber="";cardName="";expirationDate="";saveCard=!1;ngOnInit(){let a=this.authService.getUserId();a&&this.creditCardService.findByUserId(a).subscribe({next:e=>this.cards=e,error:()=>this.toastService.error("Error al cargar tarjetas")})}closeModal(){this.activeModal.dismiss()}pay(){if(!this.cardNumber&&!this.selectedCardId)return this.toastService.error("Selecciona o ingresa una tarjeta.");if(!this.cardName&&!this.selectedCardId)return this.toastService.error("Debes ingresar el nombre en la tarjeta.");let a=this.authService.getUserId();if(!a)return;if(this.saveCard&&!this.selectedCardId){let i=new $;i.userId=a,i.cardNumber=this.cardNumber,i.cardholderName=this.cardName,i.expirationDate=`${this.expirationDate}-01`,this.creditCardService.save(i).subscribe({next:()=>this.toastService.success("Tarjeta guardada exitosamente."),error:()=>this.toastService.error("Error al guardar tarjeta")})}let e=this.cartService.getItems().map(i=>({productId:i.product.productId,quantity:i.quantity,price:i.product.price,productName:i.product.name})),t=new ee;t.userId=a,t.status=1,t.items=e,t.totalPrice=this.cartService.getTotal(),this.orderService.save(t).subscribe({next:()=>{this.toastService.success("Pago y orden procesados correctamente."),this.cartService.clear(),this.activeModal.close(!0)},error:i=>this.toastService.error("Error al procesar la orden: "+i.message)})}static \u0275fac=function(e){return new(e||d)(m(J),m(P),m(re),m(ne),m(k),m(Z))};static \u0275cmp=I({type:d,selectors:[["app-payment-modal"]],decls:25,vars:8,consts:[[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"mb-3"],["type","text","placeholder","XXXX-XXXX-XXXX-XXXX",1,"form-control",3,"ngModelChange","ngModel","disabled"],["type","text","placeholder","Juan P\xE9rez",1,"form-control",3,"ngModelChange","ngModel","disabled"],["type","month",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"form-check","mb-3"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",3,"click"],[1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],["type","checkbox","id","saveCard",1,"form-check-input",3,"ngModelChange","ngModel"],["for","saveCard",1,"form-check-label"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"h5",1),c(2,"Pagar carrito"),r(),n(3,"button",2),p("click",function(){return t.closeModal()}),r()(),n(4,"div",3),f(5,ue,8,2,"div",4),x(6,"hr"),n(7,"div",4)(8,"label"),c(9,"N\xFAmero de tarjeta"),r(),n(10,"input",5),h("ngModelChange",function(o){return S(t.cardNumber,o)||(t.cardNumber=o),o}),r()(),n(11,"div",4)(12,"label"),c(13,"Nombre en la tarjeta"),r(),n(14,"input",6),h("ngModelChange",function(o){return S(t.cardName,o)||(t.cardName=o),o}),r()(),n(15,"div",4)(16,"label"),c(17,"Fecha de vencimiento"),r(),n(18,"input",7),h("ngModelChange",function(o){return S(t.expirationDate,o)||(t.expirationDate=o),o}),r()(),f(19,Ce,4,1,"div",8),r(),n(20,"div",9)(21,"button",10),p("click",function(){return t.closeModal()}),c(22,"Cancelar"),r(),n(23,"button",11),p("click",function(){return t.pay()}),c(24,"Pagar"),r()()),e&2&&(l(5),g(t.cards.length?5:-1),l(5),b("ngModel",t.cardNumber),v("disabled",!!t.selectedCardId),l(4),b("ngModel",t.cardName),v("disabled",!!t.selectedCardId),l(4),b("ngModel",t.expirationDate),v("disabled",!!t.selectedCardId),l(),g(t.selectedCardId?-1:19))},dependencies:[H,R,z,Q,B,G,U,q],encapsulation:2})};var ve=(d,a)=>a.product.productId;function _e(d,a){if(d&1){let e=_();n(0,"button",7),p("click",function(){u(e);let i=s();return C(i.clearCart())}),c(1,"Vaciar carrito"),r()}}function fe(d,a){if(d&1){let e=_();n(0,"div",9)(1,"div",13),x(2,"img",14),r(),n(3,"div",15)(4,"strong"),c(5),r(),n(6,"small",16),c(7),E(8,"number"),r(),n(9,"div",17)(10,"label",18),c(11,"Cantidad:"),r(),n(12,"input",19),p("change",function(i){let o=u(e).$implicit,j=s(2);return C(j.updateQuantity(o.product.productId,i))}),r()()(),n(13,"div",20)(14,"div",21),c(15),E(16,"number"),r(),n(17,"button",22),p("click",function(){let i=u(e).$implicit,o=s(2);return C(o.goToProduct(i.product.productId))}),c(18," Ver producto "),r(),n(19,"button",7),p("click",function(){let i=u(e).$implicit,o=s(2);return C(o.remove(i))}),c(20,"Eliminar"),r()()()}if(d&2){let e=a.$implicit,t=s(2);l(2),O("alt",e.product.name),v("src",e.product.imageUrl?t.environment.imagesUrl+e.product.imageUrl:"/assets/placeholder.png",L),l(3),A(e.product.name),l(2),T("",N(8,7,e.product.price,"1.2-2")," GTQ c/u"),l(5),v("value",e.quantity)("max",e.product.stock),l(3),T(" ",N(16,10,e.product.price*e.quantity,"1.2-2")," GTQ ")}}function ge(d,a){if(d&1){let e=_();n(0,"div",8),M(1,fe,21,13,"div",9,ve),r(),x(3,"hr"),n(4,"div",10)(5,"span"),c(6,"Total:"),r(),n(7,"span"),c(8),E(9,"number"),r()(),n(10,"div",11)(11,"button",12),p("click",function(){u(e);let i=s();return C(i.openPaymentModal())}),c(12,"Pagar carrito"),r()()}if(d&2){let e=s();l(),w(e.cartItems),l(7),T("",N(9,1,e.getTotal(),"1.2-2")," GTQ")}}function be(d,a){d&1&&(n(0,"p",6),c(1,"Tu carrito est\xE1 vac\xEDo."),r())}var y=class y{constructor(a,e,t,i,o){this.cartService=a;this.modalService=e;this.toastService=t;this.confirmActionService=i;this.router=o}cartItems=[];ngOnInit(){this.loadCart()}loadCart(){this.cartItems=this.cartService.getItems()}updateQuantity(a,e){let t=Number(e.target.value);t<=0||(this.cartService.updateItemQuantity(a,t),this.loadCart())}remove(a){this.cartService.removeItem(a.product.productId),this.loadCart()}clearCart(){this.cartService.clear(),this.loadCart(),this.toastService.success("Carrito vaciado correctamente.")}getTotal(){return this.cartService.getTotal()}openPaymentModal(){this.modalService.open(V,{centered:!0,backdrop:"static"})}goToProducts(){this.router.navigate(["/user/products"]).then(a=>{})}goToProduct(a){this.router.navigate(["user/products",a]).then(e=>{})}environment=Y;static \u0275fac=function(e){return new(e||y)(m(k),m(K),m(P),m(te),m(F))};static \u0275cmp=I({type:y,selectors:[["app-cart-items-list"]],decls:10,vars:2,consts:[[1,"cart","p-3","border","rounded","shadow-sm","bg-light"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"mb-0"],[1,"d-flex","flex-row","gap-2"],[1,"btn","btn-sm","btn-outline-secondary","me-2",3,"click"],[1,"btn","btn-sm","btn-outline-danger"],[1,"text-muted","text-center","mt-4"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"list-group","mb-3"],[1,"list-group-item","d-flex","justify-content-between","align-items-center","flex-wrap"],[1,"d-flex","justify-content-between","fw-bold","mb-3"],[1,"text-end"],[1,"btn","btn-primary",3,"click"],[1,"me-3"],["width","50",1,"rounded",3,"src","alt"],[1,"flex-grow-1"],[1,"d-block","text-muted"],[1,"mt-1"],[1,"me-1"],["type","number","min","1",1,"form-control","d-inline-block",2,"width","80px",3,"change","value","max"],[1,"d-flex","flex-row","gap-2","text-end"],[1,"fw-semibold","mb-1"],[1,"btn","btn-sm","btn-outline-primary",3,"click"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"div",1)(2,"h5",2),c(3,"Mi carrito"),r(),n(4,"div",3)(5,"button",4),p("click",function(){return t.goToProducts()}),c(6,"Agregar producto"),r(),f(7,_e,2,0,"button",5),r()(),f(8,ge,13,4)(9,be,2,0,"p",6),r()),e&2&&(l(7),g(t.cartItems.length?7:-1),l(),g(t.cartItems.length?8:9))},dependencies:[W],encapsulation:2})};D([ie({title:"Limpiar carrito",bodyQuestion:"\xBFDeseas limpiar tu carrito?",confirmText:"S\xED, eliminar"})],y.prototype,"clearCart",1);var ae=y;export{ae as CartItemsListComponent};
