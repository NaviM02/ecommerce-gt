import{k as d,o as u,t as p}from"./chunk-HGKDJBZM.js";import{T as c,X as l,aa as a}from"./chunk-DN3HB7UR.js";var n=class extends Error{};n.prototype.name="InvalidTokenError";function h(r){return decodeURIComponent(atob(r).replace(/(.)/g,(e,t)=>{let o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}function f(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return h(e)}catch{return atob(e)}}function g(r,e){if(typeof r!="string")throw new n("Invalid token specified: must be a string");e||(e={});let t=e.header===!0?0:1,o=r.split(".")[t];if(typeof o!="string")throw new n(`Invalid token specified: missing part #${t+1}`);let s;try{s=f(o)}catch(i){throw new n(`Invalid token specified: invalid base64 for part #${t+1} (${i.message})`)}try{return JSON.parse(s)}catch(i){throw new n(`Invalid token specified: invalid json for part #${t+1} (${i.message})`)}}var m=class r{constructor(e,t){this.http=e;this.router=t}baseUrl=`${p.baseUrl}/auth`;storageKey="nibelungo";doLogin(e){return this.http.post(`${this.baseUrl}`,e).pipe(c(t=>this.storeToken(t.token)))}storeToken(e){localStorage.setItem(this.storageKey,e)}getToken(){return localStorage.getItem(this.storageKey)}clearToken(){localStorage.removeItem(this.storageKey),localStorage.removeItem("cart"),this.router.navigate(["/c/login"]).then()}getDecodedToken(){let e=this.getToken();if(!e)return null;try{return g(e)}catch(t){return console.error("Token inv\xE1lido",t),null}}getUserRole(){return this.getDecodedToken()?.role??null}getUsername(){return this.getDecodedToken()?.sub??null}getUserId(){return this.getDecodedToken()?.userId??null}isAuthenticated(){let e=this.getDecodedToken();return e?e.exp*1e3>Date.now():!1}isLoggedIn(){return!!this.getToken()}static \u0275fac=function(t){return new(t||r)(a(d),a(u))};static \u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})};export{m as a};
