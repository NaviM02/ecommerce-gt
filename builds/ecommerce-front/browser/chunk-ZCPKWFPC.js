import{a as z,b as G}from"./chunk-HP5ROPUU.js";import{a as H}from"./chunk-2BG3ZEW2.js";import{a as L}from"./chunk-3RHZJOR6.js";import{a as j}from"./chunk-3VFHTPS6.js";import"./chunk-EUW5MHSP.js";import"./chunk-CTBSQTUV.js";import{f as A}from"./chunk-QNPVVT5S.js";import"./chunk-NCCT54UK.js";import"./chunk-FDP5RWEF.js";import{m as R}from"./chunk-XALT67XN.js";import{a as B}from"./chunk-5UWBJBBU.js";import{g as k,h as M,m as N,o as F}from"./chunk-HGKDJBZM.js";import{Cb as o,Db as g,Ga as a,Gb as T,Hb as I,Ib as P,Kb as V,La as u,Pa as x,Pb as m,Rb as p,Ua as w,_a as s,db as _,gb as C,hb as E,ia as h,ib as r,ja as b,jb as t,kb as c,ob as O,sb as y,tb as v}from"./chunk-DN3HB7UR.js";import{a as f,b as D}from"./chunk-PYEHUVGI.js";var q=()=>["/logistic/orders"],Q=(d,i)=>i.productId;function U(d,i){if(d&1&&(r(0,"tr")(1,"td"),o(2),t(),r(3,"td"),o(4),t(),r(5,"td"),o(6),m(7,"number"),t(),r(8,"td"),o(9),m(10,"number"),t()()),d&2){let e=i.$implicit;a(2),g(e.productName),a(2),g(e.quantity),a(2),g(p(7,4,e.price,"1.2-2")),a(3),g(p(10,7,e.price*e.quantity,"1.2-2"))}}function J(d,i){if(d&1){let e=O();r(0,"div",15)(1,"h5"),o(2,"Acciones"),t(),r(3,"div",16)(4,"label",17),o(5,"Nueva fecha de entrega:"),t(),r(6,"app-single-datepicker",18),P("modelChange",function(l){h(e);let S=v();return I(S.newDeliveryDate,l)||(S.newDeliveryDate=l),b(l)}),t(),r(7,"button",19),y("click",function(){h(e);let l=v();return b(l.updateDeliveryDate())}),o(8," Actualizar fecha "),t()(),r(9,"div")(10,"button",20),y("click",function(){h(e);let l=v();return b(l.markAsDelivered())}),o(11," Marcar como entregado "),t()()()}if(d&2){let e=v();a(6),T("model",e.newDeliveryDate)}}var W=class d{constructor(i,e,n,l){this.route=i;this.router=e;this.orderService=n;this.toastService=l}orderId;order=new A;newDeliveryDate="";ngOnInit(){this.route.paramMap.subscribe(i=>{this.orderId=Number(i.get("id")),this.orderId&&this.loadOrder()})}loadOrder(){this.orderService.findById(this.orderId).subscribe({next:i=>this.order=i,error:i=>{this.toastService.error("Error al cargar la orden"),this.router.navigate(["/logistic/orders"])}})}getStatusLabel(i){switch(i){case 1:return"En curso";case 2:return"Entregado";default:return"Desconocido"}}updateDeliveryDate(){if(!this.newDeliveryDate&&this.newDeliveryDate==="")return this.toastService.warning("Seleccione una fecha v\xE1lida");let i=new Date(this.newDeliveryDate),e=new Date;if(i.setHours(0,0,0,0),e.setHours(0,0,0,0),i<e)return this.toastService.warning("No puede establecer una fecha anterior a hoy");let n=D(f({},this.order),{deliveryDate:this.newDeliveryDate});this.orderService.save(n).subscribe({next:()=>{this.toastService.success("Fecha de entrega actualizada"),this.order.deliveryDate=this.newDeliveryDate},error:()=>this.toastService.error("No se pudo actualizar la fecha")})}markAsDelivered(){if(!this.order.deliveryDate)return this.toastService.warning("La orden no tiene una fecha de entrega establecida");let i=new Date(this.order.deliveryDate),e=new Date;if(i.setHours(0,0,0,0),e.setHours(0,0,0,0),i.getTime()!==e.getTime())return this.toastService.warning("Solo puede marcar la orden como entregada en la fecha programada de entrega");let n=D(f({},this.order),{status:2});this.orderService.save(n).subscribe({next:()=>{this.toastService.success("Orden marcada como entregada"),this.order.status=2},error:()=>this.toastService.error("No se pudo actualizar el estado")})}OrderStatus=z;static \u0275fac=function(e){return new(e||d)(u(N),u(F),u(G),u(B))};static \u0275cmp=x({type:d,selectors:[["app-pending-order-detail"]],decls:34,vars:18,consts:[[1,"main-container"],[1,"body-container"],[1,"detail-header-container"],["description","Historial de \xF3rdenes",3,"backRoute","itemName"],[1,"body","bg-white","w-100","p-5"],[1,"row","mb-3"],["labelText","Estado",1,"col-12","col-lg-6",3,"textValue"],["labelText","Usuario",1,"col-12","col-lg-6",3,"textValue"],["labelText","Fecha de la orden",1,"col-12","col-lg-6",3,"textValue"],["labelText","Fecha de entrega",1,"col-12","col-lg-6",3,"textValue"],["labelText","Total",1,"col-12","col-lg-6",3,"textValue"],[1,"mt-4","mb-2"],[1,"table-container"],[1,"table","table-bordered"],[1,"table-light"],[1,"actions","mt-4","p-3","bg-light","rounded","shadow-sm"],[1,"d-flex","align-items-center","gap-2","mb-3"],["for","deliveryDate",1,"form-label","mb-0"],[3,"modelChange","model"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"btn","btn-success","btn-sm",3,"click"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),c(3,"app-detail-page-header",3),t(),r(4,"div",4)(5,"div",5),c(6,"app-view-field",6)(7,"app-view-field",7),t(),r(8,"div",5),c(9,"app-view-field",8),m(10,"date"),c(11,"app-view-field",9),m(12,"date"),t(),r(13,"div",5),c(14,"app-view-field",10),m(15,"number"),t(),r(16,"h5",11),o(17,"Detalles de la orden"),t(),r(18,"div",12)(19,"table",13)(20,"thead",14)(21,"tr")(22,"th"),o(23,"Producto"),t(),r(24,"th"),o(25,"Cantidad"),t(),r(26,"th"),o(27,"Precio"),t(),r(28,"th"),o(29,"Subtotal"),t()()(),r(30,"tbody"),C(31,U,11,10,"tr",null,Q),t()()()(),w(33,J,12,1,"div",15),t()()),e&2&&(a(3),s("backRoute",V(17,q))("itemName","Orden #"+n.order.orderId),a(3),s("textValue",n.getStatusLabel(n.order.status)),a(),s("textValue",n.order.username),a(2),s("textValue",p(10,8,n.order.orderDate,"dd/MM/yyyy")+""),a(2),s("textValue",p(12,11,n.order.deliveryDate,"dd/MM/yyyy")+""),a(3),s("textValue",p(15,14,n.order.totalPrice,"1.2-2")+" GTQ"),a(17),E(n.order.details),a(2),_(n.order.status===n.OrderStatus.COMING?33:-1))},dependencies:[k,M,L,H,R,j],encapsulation:2})};export{W as PendingOrderDetailComponent};
