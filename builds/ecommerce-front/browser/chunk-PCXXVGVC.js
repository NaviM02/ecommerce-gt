import{a as re,b as te}from"./chunk-GXTZG3NX.js";import{a as Z,b as ie}from"./chunk-KCVL4ZD6.js";import{a as ee}from"./chunk-EUW5MHSP.js";import{a as $}from"./chunk-CTBSQTUV.js";import{a as G}from"./chunk-Q5ZSNGML.js";import{a as Q}from"./chunk-GYVK5SZF.js";import{b as z,c as J}from"./chunk-QNPVVT5S.js";import{b as Y}from"./chunk-BFNUI43J.js";import"./chunk-NCCT54UK.js";import"./chunk-FDP5RWEF.js";import{a as X}from"./chunk-NXHING3N.js";import"./chunk-IN5T55Q3.js";import{c as q,e as B,f as x,m as H}from"./chunk-XALT67XN.js";import{a as K}from"./chunk-5UWBJBBU.js";import{d as O,m as k,o as j}from"./chunk-HGKDJBZM.js";import{Bb as _,Cb as p,Db as P,F as T,Ga as s,Gb as f,Hb as h,Ib as v,Kb as F,La as w,Lb as C,Pa as V,T as y,Ua as U,_a as u,db as W,gb as L,hb as A,ia as m,ib as t,ja as d,jb as r,kb as g,l as R,ob as M,sb as D,tb as E,x as I}from"./chunk-DN3HB7UR.js";import{c as N}from"./chunk-PYEHUVGI.js";var se=()=>["/admin/users"],S=c=>({"is-invalid":c}),le=()=>["/admin","users"],me=(c,n)=>n.roleId;function de(c,n){if(c&1&&(t(0,"ng-option",23),p(1),r()),c&2){let o=n.$implicit;u("value",o),s(),P(o.roleName)}}function ue(c,n){if(c&1){let o=M();t(0,"div",11)(1,"label",12),p(2,"Contrase\xF1a"),r(),t(3,"app-input-for-password",26),v("ngModelChange",function(a){m(o);let l=E();return h(l.user.password,a)||(l.user.password=a),d(a)}),r()()}if(c&2){let o=E();s(3),f("ngModel",o.user.password)}}var b=class b{constructor(n,o,e,a){this.userService=n;this.toastService=o;this.router=e;this.route=a}id;user=new J;userStatus=!0;selectedRole=null;roles=[{roleId:1,roleName:"ADMIN"},{roleId:3,roleName:"MODERADOR"},{roleId:4,roleName:"LOGISTICA"}];ngOnInit(){this.route.paramMap.pipe(y(n=>this.id=Number(n.get("id"))),T(n=>I(()=>!!this.id,this.userService.findById(this.id).pipe(y(o=>{this.user=o,this.userStatus=o.active,this.selectedRole=this.roles.find(e=>e.roleId==this.user.role.roleId)??null})),R(!1)))).subscribe({error:n=>{if(n.status===404){this.toastService.error("El recurso al que intentas acceder no existe o fue eliminado."),this.router.navigate(["admin","users"]);return}this.toastService.error("Ocurri\xF3 un error en el servidor, porfavor intenta m\xE1s tarde.")}})}onSave(){if(!this.isValid)return this.toastService.warning("Llene todo el formulario");this.user.active=this.userStatus,this.user.role=this.selectedRole??new z,this.userService.save(this.user).subscribe({next:n=>{this.toastService.success("Tus cambios se guardaron con \xE9xito"),this.router.navigate(["admin","users"])},error:n=>{console.error(n),this.toastService.error("Ocurri\xF3 un error en el servidor, porfavor intenta m\xE1s tarde.")}})}onDelete(){this.id&&this.userService.delete(this.id).subscribe({next:n=>{this.toastService.success("Tus cambios se guardaron con \xE9xito."),this.router.navigate(["admin","users"])},error:n=>this.toastService.error("Ocurri\xF3 un error en el servidor. Intenta de nuevo m\xE1s tarde.")})}get isValid(){return!!this.user.fullName?.trim()&&!!this.user.username?.trim()&&!!this.user.email?.trim()}static \u0275fac=function(o){return new(o||b)(w(X),w(K),w(j),w(k))};static \u0275cmp=V({type:b,selectors:[["app-user-form"]],decls:49,vars:36,consts:[["fullName","ngModel"],["username","ngModel"],["email","ngModel"],["phoneNumber","ngModel"],["role","ngModel"],[1,"main-container"],[1,"body-container"],[1,"form-page-header-container"],[3,"title","description","backRoute"],[1,"body","bg-white","h-100"],[1,"row"],[1,"col-12","col-lg-6","mb-3"],[1,"form-label","required-field"],[3,"modelChange","model"],["for","fullName",1,"form-label","required-field"],["type","text","id","fullName","placeholder","Ej. Administrador",1,"form-control",3,"ngModelChange","ngModel","maxLength","ngClass"],["for","username",1,"form-label","required-field"],["type","text","id","username","placeholder","Ej. admin",1,"form-control",3,"ngModelChange","ngModel","maxLength","ngClass"],["for","email",1,"form-label","required-field"],["type","email","id","email","placeholder","Ej. direccion@correo.com",1,"form-control",3,"ngModelChange","ngModel","maxLength","ngClass"],["for","phoneNumber",1,"form-label","required-field"],["type","text","id","phoneNumber","placeholder","Ej. 52532524",1,"form-control",3,"ngModelChange","ngModel","maxLength","ngClass"],["placeholder","Selecciona un rol","id","roleSelect","name","roleSelect",3,"ngModelChange","ngModel","multiple","clearable","ngClass"],[3,"value"],[1,"form-actions-container"],[3,"saveAction","deleteAction","cancelRoute","saveText","showDelete"],["placeholder","Ingresa tu contrase\xF1a","iconPosition","left",3,"ngModelChange","ngModel"]],template:function(o,e){if(o&1){let a=M();t(0,"div",5)(1,"div",6)(2,"div",7),g(3,"app-form-page-header",8),r(),t(4,"div",9),g(5,"app-required-indicator"),t(6,"div",10)(7,"div",11)(8,"label",12),p(9,"Estado"),r(),t(10,"app-toggle-switch",13),v("modelChange",function(i){return m(a),h(e.userStatus,i)||(e.userStatus=i),d(i)}),r()()(),t(11,"div",10)(12,"div",11)(13,"label",14),p(14,"Nombre completo"),r(),t(15,"input",15,0),v("ngModelChange",function(i){return m(a),h(e.user.fullName,i)||(e.user.fullName=i),d(i)}),r(),g(17,"app-input-invalid-feedback"),r(),t(18,"div",11)(19,"label",16),p(20,"Usuario"),r(),t(21,"input",17,1),v("ngModelChange",function(i){return m(a),h(e.user.username,i)||(e.user.username=i),d(i)}),r(),g(23,"app-input-invalid-feedback"),r()(),t(24,"div",10)(25,"div",11)(26,"label",18),p(27,"Email"),r(),t(28,"input",19,2),v("ngModelChange",function(i){return m(a),h(e.user.email,i)||(e.user.email=i),d(i)}),r(),g(30,"app-input-invalid-feedback"),r(),t(31,"div",11)(32,"label",20),p(33,"Tel\xE9fono"),r(),t(34,"input",21,3),v("ngModelChange",function(i){return m(a),h(e.user.phone,i)||(e.user.phone=i),d(i)}),r(),g(36,"app-input-invalid-feedback"),r()(),t(37,"div",10)(38,"div",11)(39,"label",12),p(40,"Rol"),r(),t(41,"ng-select",22,4),v("ngModelChange",function(i){return m(a),h(e.selectedRole,i)||(e.selectedRole=i),d(i)}),L(43,de,2,2,"ng-option",23,me),r(),g(45,"app-input-invalid-feedback"),r(),U(46,ue,4,1,"div",11),r(),t(47,"div",24)(48,"app-form-actions",25),D("saveAction",function(){return m(a),d(e.onSave())})("deleteAction",function(){return m(a),d(e.onDelete())}),r()()()()()}if(o&2){let a=_(16),l=_(22),i=_(29),oe=_(35),ae=_(42);s(3),u("title",e.id?"Editar Usuario":"Nuevo Usuario")("description",e.id?"Modifica la informaci\xF3n del usuario":"Crea un nuevo usuario")("backRoute",F(24,se)),s(7),f("model",e.userStatus),s(5),f("ngModel",e.user.fullName),u("maxLength",75)("ngClass",C(25,S,a.touched&&!(e.user.fullName&&e.user.fullName.trim()))),s(6),f("ngModel",e.user.username),u("maxLength",250)("ngClass",C(27,S,l.touched&&!(e.user.username&&e.user.username.trim()))),s(7),f("ngModel",e.user.email),u("maxLength",75)("ngClass",C(29,S,i.touched&&!(e.user.email&&e.user.email.trim()))),s(6),f("ngModel",e.user.phone),u("maxLength",250)("ngClass",C(31,S,oe.touched&&!(e.user.phone&&e.user.phone.trim()))),s(7),f("ngModel",e.selectedRole),u("multiple",!1)("clearable",!0)("ngClass",C(33,S,ae.touched&&!e.selectedRole)),s(2),A(e.roles),s(3),W(e.id?-1:46),s(2),u("cancelRoute",F(35,le))("saveText",e.id?"Guardar":"Crear")("showDelete",!!e.id)}},dependencies:[Z,H,q,B,x,$,Q,ee,ie,O,G,re,te],encapsulation:2})};N([Y({title:"Eliminar usuario",bodyQuestion:"\xBFRealmente deseas eliminar este usuario?",bodyText:"Esta acci\xF3n es irreversible.",confirmText:"Entiendo, eliminar"})],b.prototype,"onDelete",1);var ne=b;export{ne as UserFormComponent};
