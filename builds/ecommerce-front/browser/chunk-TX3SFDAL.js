import{a as tt}from"./chunk-WEV7XX4Q.js";import{a as et}from"./chunk-MZTENXYX.js";import{d as Z}from"./chunk-QNPVVT5S.js";import{i as K,j as X}from"./chunk-NCCT54UK.js";import{a as Y}from"./chunk-IN5T55Q3.js";import{c as M,e as w,f as P,g as L,k as Q,l as J,m as D}from"./chunk-XALT67XN.js";import{a as k}from"./chunk-5UWBJBBU.js";import{d as $,g as z,k as H,m as G,t as x}from"./chunk-HGKDJBZM.js";import{Cb as o,Db as p,Ea as j,Eb as u,Ga as c,Gb as I,Hb as E,Ib as T,Kb as V,La as d,Pa as y,Pb as O,Rb as W,Ua as S,X as F,_a as C,aa as N,db as b,fb as h,gb as g,hb as f,ia as q,ib as a,ja as U,jb as r,kb as s,ob as B,sb as v,tb as _}from"./chunk-DN3HB7UR.js";import"./chunk-PYEHUVGI.js";var A=class e{constructor(i,t,n){this.activeModal=i;this.cartService=t;this.toastService=n}product;quantity=1;ngOnInit(){if(this.product){let i=this.cartService.getItems().find(t=>t.product.productId===this.product.productId);this.quantity=i?i.quantity:1}}confirm(){if(this.quantity>this.product.stock)return this.toastService.error("No puedes agregar m\xE1s que el stock disponible.");this.cartService.getItems().find(t=>t.product.productId===this.product.productId)?(this.cartService.updateItemQuantity(this.product.productId,this.quantity),this.toastService.success(`Cantidad actualizada a ${this.quantity} en el carrito.`)):(this.cartService.addItem(this.product,this.quantity),this.toastService.success(`${this.quantity} producto(s) agregados al carrito.`)),this.activeModal.close(!0)}close(){this.activeModal.dismiss(!1)}static \u0275fac=function(t){return new(t||e)(d(K),d(et),d(k))};static \u0275cmp=y({type:e,selectors:[["app-add-to-cart-modal"]],inputs:{product:"product"},decls:15,vars:4,consts:[[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"fw-semibold"],["for","quantity",1,"form-label"],["id","quantity","type","number","min","1",1,"form-control",3,"ngModelChange","ngModel","max"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",3,"click"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"h4",1),o(2,"Agregar al carrito"),r(),a(3,"button",2),v("click",function(){return n.close()}),r()(),a(4,"div",3)(5,"p",4),o(6),r(),a(7,"label",5),o(8),r(),a(9,"input",6),T("ngModelChange",function(m){return E(n.quantity,m)||(n.quantity=m),m}),r()(),a(10,"div",7)(11,"button",8),v("click",function(){return n.close()}),o(12,"Cancelar"),r(),a(13,"button",9),v("click",function(){return n.confirm()}),o(14,"Agregar"),r()()),t&2&&(c(6),p(n.product.name),c(2),u(" Cantidad (m\xE1x ",n.product.stock,") "),c(),I("ngModel",n.quantity),C("max",n.product.stock))},dependencies:[D,M,L,w,J,Q,P],encapsulation:2})};var R=class e{constructor(i){this.http=i}baseUrl=`${x.baseUrl}/ratings`;save(i){return this.http.post(`${this.baseUrl}`,i)}static \u0275fac=function(t){return new(t||e)(N(H))};static \u0275prov=F({token:e,factory:e.\u0275fac,providedIn:"root"})};var mt=()=>[1,2,3,4,5],lt=(e,i)=>i.categoryId,st=(e,i)=>i.ratingId;function pt(e,i){if(e&1&&s(0,"img",3),e&2){let t=_();C("src",t.imagePreviewUrl,j)}}function ut(e,i){e&1&&s(0,"i",21)}function gt(e,i){e&1&&s(0,"i",22)}function ft(e,i){if(e&1&&(g(0,ut,1,0,"i",21,h),g(2,gt,1,0,"i",22,h),a(4,"span",23),o(5),r()),e&2){let t=_();f(t.getStars(t.Math.round(t.product.averageRating))),c(2),f(t.getEmptyStars(t.Math.round(t.product.averageRating))),c(3),u("",t.product.averageRating,"/5")}}function vt(e,i){e&1&&(a(0,"span",8),o(1,"Sin calificaciones a\xFAn"),r())}function _t(e,i){if(e&1&&(a(0,"span",24),o(1),r()),e&2){let t=i.$implicit;c(),p(t.name)}}function Ct(e,i){if(e&1&&g(0,_t,2,1,"span",24,lt),e&2){let t=_();f(t.product.categories)}}function ht(e,i){e&1&&(a(0,"span",8),o(1,"No hay categor\xEDas asignadas"),r())}function St(e,i){e&1&&s(0,"i",21)}function bt(e,i){e&1&&s(0,"i",22)}function xt(e,i){if(e&1&&(a(0,"div",25)(1,"div",7),g(2,St,1,0,"i",21,h),g(4,bt,1,0,"i",22,h),a(6,"span",26),o(7),r()(),a(8,"p",27),o(9),r(),a(10,"small",8),o(11),O(12,"date"),r()()),e&2){let t=i.$implicit,n=_(2);c(2),f(n.getStars(t.stars)),c(2),f(n.getEmptyStars(t.stars)),c(3),p(t.username),c(2),p(t.comment),c(2),p(W(12,3,t.createdAt,"mediumDate"))}}function yt(e,i){if(e&1&&g(0,xt,13,6,"div",25,st),e&2){let t=_();f(t.product.ratings)}}function It(e,i){e&1&&(a(0,"p",8),o(1,"A\xFAn no hay comentarios para este producto."),r())}function Et(e,i){if(e&1){let t=B();a(0,"span",28),v("click",function(){let l=q(t).$implicit,m=_();return U(m.newRating.stars=l)}),s(1,"i",29),r()}if(e&2){let t=i.$implicit,n=_();c(),C("ngClass",n.newRating.stars>=t?"fa-solid fa-star text-warning":"fa-regular fa-star text-warning")}}var nt=class e{constructor(i,t,n,l,m,Tt){this.route=i;this.productService=t;this.ratingService=n;this.modalService=l;this.toastService=m;this.authService=Tt}id;product=new Z;imagePreviewUrl;newRating={stars:0,comment:""};submitting=!1;environment=x;ngOnInit(){this.id=Number(this.route.snapshot.paramMap.get("id")),this.id&&this.loadProduct(this.id)}loadProduct(i){this.productService.findById(i).subscribe({next:t=>{this.product=t,t.imageUrl&&(this.imagePreviewUrl=x.imagesUrl+t.imageUrl)},error:()=>this.toastService.error("Error al cargar el producto.")})}getStars(i){return Array.from({length:i})}getEmptyStars(i){return Array.from({length:5-i})}addRating(){if(!this.product)return;let i=this.authService.getUserId();if(!i)return this.toastService.error("Debes iniciar sesi\xF3n para calificar.");if(this.newRating.stars<1)return this.toastService.error("Selecciona al menos una estrella.");this.submitting=!0;let t={productId:this.id,userId:i,stars:this.newRating.stars,comment:this.newRating.comment};this.ratingService.save(t).subscribe({next:n=>{this.toastService.success("\xA1Gracias por tu calificaci\xF3n!"),this.product.ratings||(this.product.ratings=[]),this.product.ratings.unshift(n),this.newRating={stars:0,comment:""},this.submitting=!1},error:()=>{this.toastService.error("Error al enviar tu calificaci\xF3n."),this.submitting=!1}})}openAddCartModal(){let i=this.modalService.open(A,{centered:!0,size:"md",backdrop:"static"});i.componentInstance.product=this.product}Math=Math;static \u0275fac=function(t){return new(t||e)(d(G),d(tt),d(R),d(X),d(k),d(Y))};static \u0275cmp=y({type:e,selectors:[["app-product-detail"]],decls:49,vars:14,consts:[[1,"container","py-4"],[1,"row","g-4"],[1,"col-md-5","text-center",2,"min-width","400px","max-width","400px","text-align","center"],["alt","Imagen del producto",1,"img-fluid","rounded","border",3,"src"],[1,"col-md-7"],[1,"fw-semibold"],[1,"text-muted","mb-1"],[1,"d-flex","align-items-center","mb-2"],[1,"text-muted"],[1,"text-success","fw-bold","mt-2"],[1,"mb-1"],[1,"mt-3"],[1,"btn","btn-primary","mt-5",3,"click"],[1,"my-4"],[1,"ratings","mt-4"],[1,"fw-semibold","mb-3"],[1,"add-rating","mt-4"],[1,"mb-2"],[1,"me-2",2,"cursor","pointer"],["rows","3","placeholder","Escribe un comentario (opcional)...",1,"form-control","mb-2",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fa","fa-star","text-warning","me-1"],[1,"fa-regular","fa-star","text-warning","me-1"],[1,"ms-2","fw-semibold"],[1,"badge","bg-primary-subtle","text-primary","border","mx-1"],[1,"border","rounded","p-3","mb-3","bg-light"],[1,"ms-2","fw-bold"],[1,"mb-0"],[1,"me-2",2,"cursor","pointer",3,"click"],[3,"ngClass"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),S(3,pt,1,1,"img",3),r(),a(4,"div",4)(5,"h2",5),o(6),r(),a(7,"p",6),o(8),r(),a(9,"div",7),S(10,ft,6,1)(11,vt,2,0,"span",8),r(),a(12,"h4",9),o(13),r(),a(14,"p",10)(15,"strong"),o(16,"Condici\xF3n:"),r(),o(17),r(),a(18,"p",10)(19,"strong"),o(20,"Stock:"),r(),o(21),r(),a(22,"p",10)(23,"strong"),o(24,"Vendedor:"),r(),o(25),r(),a(26,"div",11)(27,"strong"),o(28,"Categor\xEDas:"),r(),S(29,Ct,2,0)(30,ht,2,0,"span",8),r(),a(31,"button",12),v("click",function(){return n.openAddCartModal()}),o(32,"Agregar al carrito"),r()()(),s(33,"hr",13),a(34,"div",14)(35,"h5",15),o(36,"Opiniones de compradores"),r(),S(37,yt,2,0)(38,It,2,0,"p",8),r(),s(39,"hr",13),a(40,"div",16)(41,"h5",15),o(42,"Agrega tu opini\xF3n"),r(),a(43,"div",17),g(44,Et,2,1,"span",18,h),r(),a(46,"textarea",19),T("ngModelChange",function(m){return E(n.newRating.comment,m)||(n.newRating.comment=m),m}),r(),a(47,"button",20),v("click",function(){return n.addRating()}),o(48),r()()()),t&2&&(c(3),b(n.imagePreviewUrl?3:-1),c(3),p(n.product.name),c(2),p(n.product.description),c(2),b(n.product.averageRating&&n.product.averageRating>0?10:11),c(3),u("",n.product.price," GTQ"),c(4),u(" ",n.product.condition===1?"Nuevo":"Usado",""),c(4),u(" ",n.product.stock,""),c(4),u(" ",n.product.sellerName,""),c(4),b(n.product.categories.length?29:30),c(8),b(n.product.ratings.length?37:38),c(7),f(V(13,mt)),c(2),I("ngModel",n.newRating.comment),c(),C("disabled",n.submitting),c(),u(" ",n.submitting?"Enviando...":"Enviar calificaci\xF3n"," "))},dependencies:[z,$,D,M,w,P],encapsulation:2})};export{nt as ProductDetailComponent};
