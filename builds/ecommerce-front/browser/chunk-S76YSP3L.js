import"./chunk-BYXBJQAS.js";import{a as q}from"./chunk-WEV7XX4Q.js";import{a as H}from"./chunk-3RHZJOR6.js";import{a as J}from"./chunk-3VFHTPS6.js";import{a as Q}from"./chunk-5GLP43BU.js";import"./chunk-CTBSQTUV.js";import{d as G,g as L}from"./chunk-QNPVVT5S.js";import{i as O,j as z}from"./chunk-NCCT54UK.js";import"./chunk-FDP5RWEF.js";import{a as V}from"./chunk-IN5T55Q3.js";import{c as j,e as B,f as W,m as x}from"./chunk-XALT67XN.js";import{a as M}from"./chunk-5UWBJBBU.js";import{g as F,m as R,o as U,t as T}from"./chunk-HGKDJBZM.js";import{Cb as a,Db as g,Ea as k,Eb as u,Ga as c,Gb as y,Hb as D,Ib as P,Kb as w,La as d,Pa as C,Pb as A,Rb as N,Ua as S,_a as E,db as h,fb as b,gb as v,hb as f,ib as r,jb as n,kb as s,sb as p,tb as _}from"./chunk-DN3HB7UR.js";import"./chunk-PYEHUVGI.js";var I=class e{constructor(t,i,o,l){this.activeModal=t;this.sanctionService=i;this.toastService=o;this.authService=l}sellerId;sellerName;sanction=new L;save(){if(!this.sanction.reason||!this.sanction.endDate)return this.toastService.warning("Debe ingresar motivo y fecha de fin");let t=this.authService.getUserId();if(!t)return this.toastService.warning("No hay ususario loggeado");this.sanction.userId=this.sellerId,this.sanction.moderatorId=t,this.sanctionService.save(this.sanction).subscribe({next:()=>{this.toastService.success("Sanci\xF3n creada correctamente"),this.activeModal.close(!0)},error:()=>{this.toastService.error("Error al crear la sanci\xF3n")}})}close(){this.activeModal.dismiss(!1)}static \u0275fac=function(i){return new(i||e)(d(O),d(Q),d(M),d(V))};static \u0275cmp=C({type:e,selectors:[["app-add-sanction-modal"]],inputs:{sellerId:"sellerId",sellerName:"sellerName"},decls:22,vars:3,consts:[[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"mb-3"],[1,"form-label","fw-semibold"],["rows","3","placeholder","Describe el motivo de la sanci\xF3n",1,"form-control",3,"ngModelChange","ngModel"],[3,"modelChange","model"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(i,o){i&1&&(r(0,"div",0)(1,"h5",1),a(2,"Crear sanci\xF3n"),n(),r(3,"button",2),p("click",function(){return o.close()}),n()(),r(4,"div",3)(5,"p")(6,"strong"),a(7,"Usuario sancionado:"),n(),a(8),n(),r(9,"div",4)(10,"label",5),a(11,"Motivo"),n(),r(12,"textarea",6),P("ngModelChange",function(m){return D(o.sanction.reason,m)||(o.sanction.reason=m),m}),n()(),r(13,"div",4)(14,"label",5),a(15,"Fecha fin"),n(),r(16,"app-single-datepicker",7),P("modelChange",function(m){return D(o.sanction.endDate,m)||(o.sanction.endDate=m),m}),n()()(),r(17,"div",8)(18,"button",9),p("click",function(){return o.close()}),a(19,"Cancelar"),n(),r(20,"button",10),p("click",function(){return o.save()}),a(21,"Guardar"),n()()),i&2&&(c(8),u(" ",o.sellerName,""),c(4),y("ngModel",o.sanction.reason),c(4),y("model",o.sanction.endDate))},dependencies:[x,j,B,W,J],encapsulation:2})};var ee=()=>["/moderator","products"],te=(e,t)=>t.categoryId,ie=(e,t)=>t.ratingId;function ne(e,t){if(e&1&&s(0,"img",5),e&2){let i=_();E("src",i.imagePreviewUrl,k)}}function oe(e,t){e&1&&s(0,"i",21)}function re(e,t){e&1&&s(0,"i",22)}function ae(e,t){if(e&1&&(v(0,oe,1,0,"i",21,b),v(2,re,1,0,"i",22,b),r(4,"span",23),a(5),n()),e&2){let i=_();f(i.getStars(i.Math.round(i.product.averageRating))),c(2),f(i.getEmptyStars(i.Math.round(i.product.averageRating))),c(3),u("",i.product.averageRating,"/5")}}function ce(e,t){e&1&&(r(0,"span",10),a(1,"Sin calificaciones a\xFAn"),n())}function de(e,t){if(e&1&&(r(0,"span",24),a(1),n()),e&2){let i=t.$implicit;c(),g(i.name)}}function le(e,t){if(e&1&&v(0,de,2,1,"span",24,te),e&2){let i=_();f(i.product.categories)}}function me(e,t){e&1&&(r(0,"span",10),a(1,"No hay categor\xEDas asignadas"),n())}function se(e,t){e&1&&s(0,"i",21)}function pe(e,t){e&1&&s(0,"i",22)}function ue(e,t){if(e&1&&(r(0,"div",25)(1,"div",9),v(2,se,1,0,"i",21,b),v(4,pe,1,0,"i",22,b),r(6,"span",26),a(7),n()(),r(8,"p",27),a(9),n(),r(10,"small",10),a(11),A(12,"date"),n()()),e&2){let i=t.$implicit,o=_(2);c(2),f(o.getStars(i.stars)),c(2),f(o.getEmptyStars(i.stars)),c(3),g(i.username),c(2),g(i.comment),c(2),g(N(12,3,i.createdAt,"mediumDate"))}}function ve(e,t){if(e&1&&v(0,ue,13,6,"div",25,ie),e&2){let i=_();f(i.product.ratings)}}function fe(e,t){e&1&&(r(0,"p",10),a(1,"A\xFAn no hay comentarios para este producto."),n())}var K=class e{constructor(t,i,o,l,m){this.route=t;this.productService=i;this.router=o;this.toastService=l;this.modalService=m}id;product=new G;imagePreviewUrl;environment=T;ngOnInit(){this.id=Number(this.route.snapshot.paramMap.get("id")),this.id&&this.loadProduct(this.id)}loadProduct(t){this.productService.findById(t).subscribe({next:i=>{this.product=i,i.imageUrl&&(this.imagePreviewUrl=T.imagesUrl+i.imageUrl)},error:()=>this.toastService.error("Error al cargar el producto.")})}getStars(t){return Array.from({length:t})}getEmptyStars(t){return Array.from({length:5-t})}accept(){this.product.seller={userId:this.product.sellerId},this.product.status=2,this.productService.save(this.product).subscribe({next:t=>{this.toastService.info("Producto Aceptado!"),this.router.navigate(["moderator","products"])},error:()=>this.toastService.error("Error al guardar el producto")})}reject(){this.product.seller={userId:this.product.sellerId},this.product.status=3,this.productService.save(this.product).subscribe({next:t=>{this.toastService.info("Producto Rechazado!"),this.router.navigate(["moderator","products"])},error:()=>this.toastService.error("Error al guardar el producto")})}openSanctionModal(){let t=this.modalService.open(I,{centered:!0,size:"lg",backdrop:"static"});t.componentInstance.sellerId=this.product.sellerId,t.componentInstance.sellerName=this.product.sellerName,t.result.then(i=>{i&&this.reject()}).catch(()=>{})}Math=Math;static \u0275fac=function(i){return new(i||e)(d(R),d(q),d(U),d(M),d(z))};static \u0275cmp=C({type:e,selectors:[["app-product-m-detail"]],decls:46,vars:14,consts:[[1,"detail-header-container"],[3,"backRoute","description","itemName"],[1,"container","py-4"],[1,"row","g-4"],[1,"col-md-5","text-center",2,"min-width","400px","max-width","400px","text-align","center"],["alt","Imagen del producto",1,"img-fluid","rounded","border",3,"src"],[1,"col-md-7"],[1,"fw-semibold"],[1,"text-muted","mb-1"],[1,"d-flex","align-items-center","mb-2"],[1,"text-muted"],[1,"text-success","fw-bold","mt-2"],[1,"mb-1"],[1,"mt-3"],[1,"d-flex","flex-row","gap-2","text-end"],[1,"btn","btn-outline-success","mt-5",3,"click"],[1,"btn","btn-outline-warning","mt-5",3,"click"],[1,"btn","btn-outline-danger","mt-5",3,"click"],[1,"my-4"],[1,"ratings","mt-4"],[1,"fw-semibold","mb-3"],[1,"fa","fa-star","text-warning","me-1"],[1,"fa-regular","fa-star","text-warning","me-1"],[1,"ms-2","fw-semibold"],[1,"badge","bg-primary-subtle","text-primary","border","mx-1"],[1,"border","rounded","p-3","mb-3","bg-light"],[1,"ms-2","fw-bold"],[1,"mb-0"]],template:function(i,o){i&1&&(r(0,"div",0),s(1,"app-detail-page-header",1),n(),r(2,"div",2)(3,"div",3)(4,"div",4),S(5,ne,1,1,"img",5),n(),r(6,"div",6)(7,"h2",7),a(8),n(),r(9,"p",8),a(10),n(),r(11,"div",9),S(12,ae,6,1)(13,ce,2,0,"span",10),n(),r(14,"h4",11),a(15),n(),r(16,"p",12)(17,"strong"),a(18,"Condici\xF3n:"),n(),a(19),n(),r(20,"p",12)(21,"strong"),a(22,"Stock:"),n(),a(23),n(),r(24,"p",12)(25,"strong"),a(26,"Vendedor:"),n(),a(27),n(),r(28,"div",13)(29,"strong"),a(30,"Categor\xEDas:"),n(),S(31,le,2,0)(32,me,2,0,"span",10),n(),r(33,"div",14)(34,"button",15),p("click",function(){return o.accept()}),a(35,"Aceptar"),n(),r(36,"button",16),p("click",function(){return o.reject()}),a(37,"Rechazar"),n(),r(38,"button",17),p("click",function(){return o.openSanctionModal()}),a(39,"Sancionar"),n()()()(),s(40,"hr",18),r(41,"div",19)(42,"h5",20),a(43,"Opiniones de compradores"),n(),S(44,ve,2,0)(45,fe,2,0,"p",10),n()()),i&2&&(c(),E("backRoute",w(13,ee))("description","Detalle del producto")("itemName",o.product?o.product.name:""),c(4),h(o.imagePreviewUrl?5:-1),c(3),g(o.product.name),c(2),g(o.product.description),c(2),h(o.product.averageRating&&o.product.averageRating>0?12:13),c(3),u("",o.product.price," GTQ"),c(4),u(" ",o.product.condition===1?"Nuevo":"Usado",""),c(4),u(" ",o.product.stock,""),c(4),u(" ",o.product.sellerName,""),c(4),h(o.product.categories.length?31:32),c(13),h(o.product&&o.product.ratings&&o.product.ratings.length?44:45))},dependencies:[F,x,H],encapsulation:2})};export{K as ProductMDetailComponent};
